[README.md](https://github.com/user-attachments/files/22592474/README.md)
# 最优集合点计算器 v1.0

## 项目概述

最优集合点计算器是一个用于计算多个地点之间最佳聚集位置的桌面应用程序。该应用通过分析多个地理位置，计算出一个最优的集合点，使得所有人到达该点的总时间最短，非常适合用于选择物质集散中心、设置区域总店、会议地点选择、团队活动策划等场景。

## 功能特点

- **多地图平台支持**：支持高德地图、百度地图和腾讯地图三大主流地图服务
- **地点权重设置**：可为每个地点设置不同权重，反映该地点的重要程度或人数
- **智能聚类算法**：提供HDBSCAN和容量约束K-Means两种聚类算法，适应不同场景需求
- **多种优化算法**：提供"总成本最低"和"最长时间最低"两种优化策略，满足不同的决策需求
- **地理编码功能**：自动将地址转换为经纬度坐标
- **逆地理编码功能**：将计算得到的最优点经纬度转换为详细结构化地址
- **路线规划**：计算各地点到集合点的最优路线和时间
- **地图可视化显示**：支持在地图上直观显示计算结果，包括最优集合点、所有地点标记和连线
- **多API底图支持**：根据选择的API类型自动使用对应的地图底图（高德、腾讯）
- **直观的用户界面**：简洁易用的图形界面，操作便捷

## 技术架构

### 核心组件

- **OptimalPointFinder**：核心算法类，负责计算最优集合点
- **MapAPI**：地图服务抽象接口，定义了地图服务的通用方法
  - AmapAPI：高德地图API实现
  - BaiduMapAPI：百度地图API实现
  - TencentMapAPI：腾讯地图API实现
- **GatheringPointApp**：PyQt5实现的图形用户界面

### 技术栈

- **Python 3.10+**：核心编程语言
- **PyQt5**：图形用户界面框架
- **NumPy**：科学计算库，用于坐标处理和数学运算
- **scikit-learn**：机器学习库，提供K-Means聚类算法
- **HDBSCAN**：密度聚类算法库
- **Requests**：HTTP请求库，用于调用地图API

## 安装指南

### 环境要求

- Python 3.10 或更高版本
- pip 包管理工具

### 安装步骤

1. 克隆或下载项目代码

2. 安装依赖包
   ```bash
   pip install -r requirements.txt
   ```

3. 运行应用程序
   ```bash
   python main.py
   ```

## 使用指南

### 基本使用流程

1. **设置地图API**
   - 选择地图API类型（高德地图、百度地图或腾讯地图）
   - 输入对应的API密钥（需要自行在各地图平台申请）

2. **添加地点**
   - 在地址输入框中输入地点名称或详细地址
   - 可选择为每个地点设置权重（默认为1.0）
   - 点击"添加地点"按钮将地点添加到列表中

3. **选择聚类算法**（可选）
   - 不使用聚类：直接计算所有地点的最优集合点
   - HDBSCAN：适合处理不规则分布的地点
   - 容量约束K-Means：适合处理均匀分布的地点

4. **选择优化算法**
   - **总成本最低**：优化所有地点到集合点的总时间成本，追求整体效率最优
   - **最长时间最低**：优化最远地点到集合点的时间，追求公平性和减少极端情况

5. **计算最优集合点**
   - 点击"计算最优集合点"按钮
   - 系统将显示计算结果，包括最优集合点的坐标、地址和到各地点的总时间

### 高级功能

- **地点管理**：可以编辑或删除已添加的地点
- **权重调整**：可以随时调整各地点的权重并重新计算
- **聚类参数设置**：可根据需要调整聚类算法的参数

## 注意事项

- 使用前需要申请相应地图平台的API密钥
- 地图API可能有调用次数限制，请合理使用
- 计算结果的准确性依赖于地图API提供的数据

## 更新日志

### 2024-12-30 (最新更新)
- **新增Excel导入功能**：支持从Excel(.xlsx, .xls)和CSV文件批量导入地点数据
- **智能坐标处理**：自动识别文件中的经纬度，缺失时通过地图API自动搜索
- **多编码支持**：自动处理UTF-8、GBK、latin-1编码，确保中文文件正常读取
- **UI界面优化**：在主界面添加"导入Excel"按钮，提供便捷的批量导入入口
- **依赖更新**：添加pandas和openpyxl库支持Excel文件处理
- **错误处理增强**：提供详细的导入结果统计和错误信息反馈
- **新增优化算法选择**：
  - **总成本最低**：优化所有地点到集合点的总时间成本，适合追求整体效率最优的场景
  - **最长时间最低**：优化最远地点到集合点的时间，适合追求公平性和减少极端情况的场景
  - 用户可根据实际需求选择合适的优化策略，提供更灵活的决策支持

### v1.0 - 2024-12-17 更新
- **候选地点选择功能**：
  - 新增地点搜索时的候选结果选择功能，避免添加错误的同名地点
  - 支持显示最多10个候选地点，包含地点名称、详细地址、类型和坐标信息
  - 添加双击快速选择功能，提升用户操作体验
  - 适用于所有地图API（高德、百度、腾讯）
- **地图API功能增强**：
  - 为所有地图API添加search_locations方法，支持返回多个候选地点
  - 优化地理编码准确性，提供更精确的地点定位
  - 改进错误处理机制，提供更友好的用户提示

### 2024-12-19 更新
- **地图可视化功能增强**：
  - 添加了地点到最优集合点的连线显示，使用虚线样式便于识别
  - 优化了地点标记样式，使用圆点标记降低视觉干扰
  - 改进了地图显示逻辑，根据选择的API类型自动使用对应的地图底图
- **多API底图支持**：
  - 高德地图：使用高德地图底图和标记样式
  - 百度地图：使用百度地图底图和圆形标记
  - 腾讯地图：使用腾讯地图底图和多标记样式
- **坐标格式优化**：根据不同API的坐标格式要求自动调整经纬度顺序
- **用户体验改进**：
  - 地图自动居中显示所有标记点
  - 连线采用半透明虚线样式，视觉效果更佳
  - 最优集合点使用醒目的红色标记突出显示

### 2024-12-18 更新

- 实现了地图可视化显示基础功能
- 集成了PyQtWebEngine支持Web地图显示

## 许可证

本项目采用Apache-2.0许可证。详情请参阅LICENSE文件。
